magic_box = b'\x33\xE2\x73\x9B\x7D\x6E\x34\x52\x08\x75\x27\x97\x10\x1D\xF7\xB1\x02\xB2\xF5\xC1\x99\x3A\x43\x96\x23\xC5\x35\x32\x06\x05\x6C\xF1\x04\x53\x5B\x7E\xCB\xF8\xEF\x09\x87\xDC\xCE\x2F\x5D\x28\x3F\x77\x0F\x84\xDB\xF3\xDB\xA7\xD8\xB2\x72\x10\x1D\x93\x66\x72\x69\xFF\x9F\xE1\x62\x27\x78\x58\x33\xBD\xE8\x20\x27\x90\xD3\x31\xA7\xEF\x05\xC2\x97\x69\x9D\xA7\x0E\x53\xF6\xCC\xBC\x04\x97\x29\xFC\xF4\xF7\x7E\x90\x49\xF2\x03\xA9\x9D\x11\x04\x75\x48\xC1\xC8\xC3\x70\xF1\x00\x35\xA0\x66\xDF\x97\x73\x8E\x02\xF0\xBD\x83\x02\xEC\xF5\x2A\x64\x61\x70\xBA\x66\x29\x4A\xEF\x2B\x3B\x32\x2F\x49\x02\xE4\xD3\x7A\x65\x94\x87\xEF\x18\xF9\x4E\x4D\xE4\x18\xB4\x2A\x1C\x66\x33\x02\x1F\xB4\xBD\xAF\x09\x72\x11\xCE\x76\x01\x81\xB2\xF8\x21\x22\x9C\xE5\x29\xF6\x89\x42\xFB\x8D\xA5\x09\xA3\x58\xAA\x64\x78\x74\xB2\x12\x69\x7E\xA1\xC5\x78\x72\xB8\x22\xCE\x3D\xBB\xD4\x17\x5C\x9D\x31\x20\xF8\x94\x2B\x75\xBC\x8D\x81\xA0\x97\xC2\xCF\xEF\x82\xA8\x7C\xCE\xEB\xF7\xDE\xBD\xC0\xFB\x8B\x41\xA4\x2A\xC7\xC1\x91\x9E\x92\xD6\xBF\xEE\x94\x89\x03\xB3\x6A\xE4\x57\x13\x33\xC0\xF1\x3D\x6D\xF8\x86\x25\xE3\x70\xBD\x2C\x50\x79\x3A\xDC\xAE\x8E\x86\x81\xF8\x09\x93\x7F\xF5\xBD\x99\xE5\x5D\x83\xAA\xAA\xCE\x5E\xBB\xDC\x7C\x97\xF7\x68\x44\x8B\xB3\x8C\x0A\x7C\xBE\x9D\x83\x31\x8A\x48\x99\xC7\x53\x48\x8C\x6A\x9A\x11\x99\x78\x04\xCD\xC8\xB6\x13\xE2\xFB\xE5\xCC\x46\x62\x5D\x91\xA4\x61\xD4\x4C\xF3\xCA\x90\x7D\x96\x7B\x96\x26\xA6\x24\xF3\x0D\xBF\xC5\xBD\xEC\x09\xAE\xCE\xBB\x7E\x58\xC0\x4E\x9B\xCA\xA6\xC5\xF3\xF9\x37\x73\x7D\x6D\x2E\xA1\x0F\xC6\x64\x42\xF4\x52\x7E\x9B\xFB\x1A\x79\x45\x1D\x36\x54\x2D\xF8\x81\xB2\x57\x56\xF2\x13\x3B\xE6\xD1\x5F\x2D\x53\xBE\xAA\xE2\x8C\x34\x78\xF9\x50\x33\x95\x6B\xF5\xB0\xEE\x7B\xA0\xAD\x7C\xC5\xA9\x86\x88\x51\x09\x31\xC2\x5A\x86\x09\x84\x47\x2C\xFC\x14\x5F\x30\x3A\xCB\xC5\x53\x8E\x01\x93\xE6\x21\xC4\xFF\x55\x46\xE4\xA7\x5A\xBF\xB0\x77\xAB\x16\xCB\x7E\x5C\x6B\x2A\xCE\xB5\x77\xB2\x8D\x13\xB8\xCF\x15\x10\x08\xBC\x4B\x58\xC2\xA1\x74\x09\x54\x64\x9E\x76\xCE\xE0\x54\x11\x65\xF9\x08\xC0\x6F\x67\xFE\xE6\x77\xF7\x70\xE3\xA7\x32\x9A\x2C\xAE\xC0\x81\x7F\x04\x92\x9D\x08\xE9\x55\x0F\xE0\xDD\x9E\x69\xE6\x17\x10\x60\x2E\xB1\xC7\xF9\x0A\x3A\xC6\x93\xAF\x1D\x56\x40\x08\x59\xD4\xEF\x82\xD3\x33\x7E\x41\xA5\xC4\xD5\xFA\xDB\xEC\x14\xAB\x89\xB0\x4D\xEF\xD6\x4D\xD3\x5A\x51\x77\x72\x20\x44\x61\x2A\x77\x07\x22\xA6\x99\xFB\x94\xB7\x56\xB9\x81\x49\x78\x84\x91\xB2\x19\x69\xF5\x81\xA4\xE2\x40\x70\x3C\x6B\xCE\x8A\xBE\x46\xFB\xC3\x20\xDA\x7E\x27\x94\x79\xBB\x82\x6E\x0E\xF6\x2A\x30\xFD\x60\x35\x66\xC4\xE6\xEF\xAF\x13\x83\x4A\x13\x46\x02\xE6\x31\xFC\xB5\x5A\xDF\xD5\x65\x1F\x59\xCE\x9B\x8A\xEE\x52\x4B\xD7\x10\x7C\xB6\x82\x57\x1A\xBF\x81\x34\x7E\xE7\xC8\xD4\x76\x92\xD5\x9C\x5A\xAC\x60\x70\xAC\xA4\x20\x8D\xEE\x2F\x52\xD7\x73\x3F\x03\xB8\xC1\x99\x05\x7F\x04\x6E\x84\xEB\xD6\xD9\x55\x96\x4D\x28\xAE\x3D\xFF\xAF\x2F\x0A\x59\xFC\x1F\x63\x0C\xB0\xD4\xD1\x9E\x25\x4B\xA6\xA4\x79\x67\x45\x99\x33\x96\x64\x8B\x30\xE1\x18\xB9\x59\x41\x4C\xFA\x20\x31\x93\x4C\xFD\xED\xFD\xB1\x94\x8C\x8A\x37\xA6\x50\x42\x34\x82\x26\xFB\xE9\x24\x0E\x89\x59\x1B\xB2\x6A\x53\xF5\x44\xFF\x7E\x00\xFD\xF4\x79\xA9\xBD\xB4\x9C\x21\x0B\xB0\x21\x67\xDB\xE0\x09\x32\x6C\x6F\xC9\x0B\x69\xF3\xE9\xDF\x98\xAD\x4E\x33\x45\x02\x83\xB6\x21\x0B\x9A\xD9\x58\xB4\x88\xA8\x4C\xF7\x02\x9B\x6E\xAD\x8B\x85\xA1\x26\xEA\x19\x4F\xE9\x7C\x00\x66\x04\x44\xBE\x34\x4C\xE0\xAB\x79\xA9\xCC\x9D\xED\x57\xB7\x29\x29\xAE\x0E\x19\xF4\x2F\xE4\x60\x31\x75\x84\x0C\x4E\x34\x6E\x8F\x1F\x92\x78\x15\x23\xBB\xE8\xEC\xA0\x23\x60\x29\xC3\x2C\xFB\x8A\x74\xA1\xAD\xF3\x46\x17\x90\x20\xD7\x62\x36\x38\x92\xB5\xC9\xF2\x75\xB0\x7F\x84\x8D\x0F\x05\xC7\xC3\xD1\x2D\xE8\x00\x98\x29\xA2\x72\x86\x4E\x2E\xBA\x3C\x80\x53\xB9\x27\xED\xE5\xFE\x85\xC5\x0F\xCF\xB2\x7A\x4B\xE8\x2C\x7D\xC8\xE2\xFA\x51\x19\xDE\x74\x17\x2D\x86\x41\x4A\xD2\xF1\x7D\x32\x24\x1A\x86\xEC\xFF\x08\x2B\x87\x11\x6D\x81\x6F\xCD\xA9\xD3\x3A\xB5\x83\xA5\x16\x67\xD7\x68\xDD\xE0\xB8\x99\xA8\x7E\x41\x6D\xCC\xCB\x75\x2B\x33\xAD\x82\x54\x0B\xEC\x1A\x17\xC7\x49\x0D\xBD\x4C\x88\x6C\xBB\x4C\x27\xC2\xED\xFF\x1D\x1A\xA9\xEE\xAD\xB1\x82\x45\x51\xA5\x3F\xCB\xE7\xFA\xA8\x6D\x98\x7C\x0E\x87\xE6\x74\xF1\x31\x1E\xF3\xC3\xDD\x6C\xFD\x8E\x44\x3F\x7A\xAE\x45\x8A\x1B\x85\xB7\xB8\xCC\xCC\xD6\x04\xDD\xBF\x12\xCF\x73\x33\x49\xEB\x7B\x13\x38\x94\x21\x24\x31\x63\x2A\x31\x0F\x41\x50\xBE\x82\xA8\x14\x60\xB3\x2E\x2C\x0B\x8E\x91\xF4\x1D\x1A\x66\x37\xCE\xA5\x9D\xC3\x4F\xEB\xCF\xBC\xA9\x8B\x63\x96\xA2\x98\x37\x96\x43\x37\x78\x56\xB5\xDA\xA8\xD9\xE0\x8E\xB3\xA3\x5C\xA2\xBC\x9D\x96\x53\xDC\x00\xCD\x58\x84\x49\x0D\xB4\x6F\xE3\x1F\x4C\x78\xEB\xD8\xD7\x40\xB4\x2A\x14\x6C\x33\x08\x3C\x95\x3D\xAE\xB2\x13\x25\xA7\x14\x0B\xC3\x98\x28\xE3\xDF\x12\x27\x14\x8E\xC6\x25\xB7\x1D\x71\x2C\xDB\xDF\x89\x8E\x64\x88\x1E\x99\xF9\x2B\x7C\xDF\xBD\x9F\xD5\x85\xA2\x5C\xFF\xA4\xE4\x8F\xD5\x60\xFC\xFD\x41\x55\x13\x62\xA2\xB4\xA1\x9B\xF6\x92\x59\x80\x51\x55\xAB\xC4\xA3\x2A\xB2\xA3\x61\x54\x4B\xD7\x52\x17\x25\xC8\xBA\xC0\x7B\x01\x8F\xF9\xD0\xA8\x82\x01\x9D\x23\xC3\xB0\xD5\xEB\xF1\xE4\x5D\x2D\xEB\x6B\x8C\xBB\xEC\x12\xA2\x2D\xE0\x7A\xFF\x4C\xB4\x59\x4D\x12\x96\x8B\x15\xB5\x90\xA2\x23\x8A\x87\xCD\x7D\xCC\x43\x17\x4C\x7E\xC1\xD7\xD7\x0F\x99\x36\xE6\x1B\x59\x5B\x22\xA9\x1D\x01\xC8\x12\x6D\xEC\x39\x41\x52\x6D\xC9\xF4\x7A\xCF\x22\x6B\x8A\x50\xFB\x50\x00\xD6\x64\x04\xFC\xA6\x2E\xBB\xB4\x58\xB5\x6C\x5E\x9C\x00\x67\xD6\x1E\x57\x82\x90\xC8\x09\x41\x9A\xFB\xA6\x86\x6E\x50\x49\xEF\x7D\xEF\xF8\xF8\x55\x7F\x17\x2A\xF9\x59\x0A\xD8\xB5\xA2\x52\x6A\x1B\x58\xCD\x48\xFB\x60\x52\x93\x10\x2A\x17\xDA\x79\xC0\x87\x7E\x59\x9C\xF6\xF6\x71\x30\x3D\xF3\xE9\x68\x38\x98\x17\x4C\xD3\x66\xAC\xCF\xB8\xD8\x59\x41\xFA\xD5\x59\x48\xEB\xBA\x3D\x6C\x81\x09\x56\xED\x34\xCE\x2A\x53\x67\xA6\xC1\x03\xC3\x5E\xAC\x9D\x89\x28\x08\x25\xCD\x73\x89\xFF\xAB\xFC\xDC\xF5\xFE\xAC\x18\x18\xF0\x54\xAC\x70\x4E\x2A\x54\xBB\x9D\x5C\xE1\xDB\x24\x1A\xA9\xBA\x9A\x10\x09\xC7\x60\x90\x49\x23\x77\x4F\x23\xEB\xD3\x1D\x03\xB6\xCF\xF4\x94\x79\x5D\x88\x37\x56\x87\xD3\x98\xBD\xB9\x05\x88\xA0\x73\x23\x4E\x4E\x3F\x07\x65\x24\xE6\x66\xFC\xDD\x89\x4D\x9E\x09\xEF\xC6\x5B\x83\x97\x56\xE8\x1C\x15\xC2\x6D\x68\xAE\xBA\x81\x96\xA0\x6E\xF8\xAB\x8D\x84\x13\x0D\xBB\xFA\xA7\x3B\xAF\x10\x58\xB2\xB7\x0E\x65\x7A\x13\x09\x2B\xAA\x78\xBF\xB2\x88\xFA\xB6\x27\xC8\x85\x56\x47\x5D\x72\x59\x4F\x0F\x54\x6A\x15\x62\xBD\x23\x1F\x52\x6A\x2C\x30\xA5\xE8\x86\x8C\x90\xA6\xE3\x14\x48\x41\xD5\x35\x9B\xE4\x46\x82\x08\x11\xAA\x89\x27\x84\xE6\x56\x17\x40\xA7\x72\x33\xDF\xD6\x55\x5F\x45\x25\xE9\x04\x9B\x25\xA3\xD0\x80\xF0\xFB\xF2\x02\x96\xD9\xC2\x4E\xB5\x70\x5A\x51\x93\x40\xD2\xE9\x7C\x20\x19\x46\xEF\x02\xFF\x7F\xD2\x71\x58\x75\x83\xCD\xB3\xEA\xC1\x3E\xB3\x37\xE3\x28\x3D\xC2\xB5\x31\x20\x59\x71\xBD\x0D\x87\x92\x6D\x06\xEB\x02\x35\xCC\x0D\x11\xDE\xAE\x89\x78\x34\x74\x2D\x61\x01\xD8\x15\xEF\xA2\x29\xA6\xA4\x59\x95\xAF\xC9\xF0\x9A\x19\x91\x59\x76\xCC\xCE\x79\xF0\xC8\x5F\xE3\x9B\x3D\x4C\x1D\xFA\x2A\xF5\xE3\x07\xEC\xE0\x04\x0A\x23\x6C\xA8\xFE\x11\x86\x06\x6B\xB9\x44\x1E\x4C\x9B\x79\xC1\x8E\xEA\xB9\xDC\x87\x52\x26\x54\x6D\x3E\x70\x4F\xCC\x3B\xE2\x9B\x10\x29\x01\x0B\x00\x66\xA9\x70\x4E\x34\x34\xA1\xFC\xEA\xC3\x2C\xD3\xC3\x2E\xF9\x36\x76\x14\xEB\xDD\xFF\x26\xDB\x07\x00\xC3\x26\xC7\xCD\x92\x60\x6C\x84\xFD\xEA\x5C\x2D\xC2\x6B\x57\xE8\x73\xB0\x06\x4A\x9F\x53\x3F\xCA\xAD\xE6\x0B\xC8\xA3\xE8\x25\x12\xD2\x10\xAE\x9E\xF8\x28\xF5\x94\xF9\xF4\xEC\x13\x3D\x60\x1C\xA4\x8F\x70\xF2\xDA\x84\x67\x11\x6A\x17\x6B\xCA\xB7\x1E\xCC\xF5\xD3\x15\x3E\xC6\x3B\x42\x9A\x98\x7A\x9A\xC6\x20\xED\xE8\xA8\xAA\xF1\x07\x15\x72\x7D\x63\xE2\x86\xD2\x39\xC9\x91\xE9\x71\xDE\xD7\x1A\x87\xAA\xFA\x77\x03\x5C\x77\xCE\x40\x19\xB1\xDB\x5C\x67\x4F\xD3\xAE\xC4\xB7\x2D\x69\xF2\xD5\x12\xE8\x15\xB6\x7F\xF0\x7F\x1C\x71\xE1\x96\x8F\x2B\xBA\x13\xD3\x31\x6C\x67\x25\x08\xC9\x08\xF9\x09\x4A\xF6\x6F\x03\xF1\xCD\x71\xBC\x40\xAA\x7C\x2A\x59\x9E\x46\xBE\x9E\xFC\xF1\x44\x90\xED\x56\xDB\x02\x25\xBC\xF0\x20\xF0\xC0\xF3\x35\x32\x67\xB6\x15\xA4\x00\x16\x8C\xE2\xF0\x0D\x59\xB5\x95\x08\xE5\x23\x24\x46\x0F\xC9\xDB\xA3\xFE\xBA\xA5\x92\x53\x2B\xF7\x62\xA8\xB2\x56\x33\xB4\xBD\xAF\xBA\x6D\x2A\x6A\xCE\xEE\x47\x94\x32\xC7\xB3\xD2\x83\x5E\x8D\x3D\xC3\xE8\x2C\xFE\x4C\x69\x16\xC8\xC9\xE1\x16\xFA\xBB\x83\x76\xE0\x09\x8C\x1A\x64\xD6\xEE\xDD\x39\x90\xC0\xEE\x5A\x07\x3D\x9C\x48\x0B\x1A\x93\x10\x15\x09\xAC\x9B\x08\xAA\x3B\xFD\x44\x14\x3B\x0D\x5D\x32\xB4\xE5\xEB\x63\x55\x23\xF3\x78\xEE\xB0\x77\xAD\x63\x2F\xE1'


def fuck(data: bytes):
    l_data = len(data)
    buffer = bytearray(l_data)
    for i in range(l_data):
        buffer[i] = data[i] ^ magic_box[i]
    return bytes(buffer)


def payload_encode(data_str: str):
    return fuck(data_str.encode('utf8')).hex()


def payload_decode(data_str: str):
    return fuck(bytes.fromhex(data_str)).decode('utf8')


def build_ticket_payload(
        host_name, user_agent, client_id,
        ipv4_addr, ipv6_addr, mac_addr,
        ostag, local_time):
    content = '''<?xml version="1.0" encoding="UTF-8"?>
<request>
<host-name>%s</host-name>
<user-agent>%s</user-agent>
<client-id>%s</client-id>
<ipv4>%s</ipv4>
<ipv6>%s</ipv6>
<mac>%s</mac>
<ostag>%s</ostag>
<local-time>%s</local-time>
</request>''' % (
        host_name, user_agent, client_id,
        ipv4_addr, ipv6_addr, mac_addr,
        ostag, local_time
    )

    return payload_encode(content)


def build_auth_payload(
        user_id, passwd,
        ticket, client_id, host_name,
        user_agent, local_time):
    content = '''<?xml version="1.0" encoding="UTF-8"?>
<request>
<passwd>%s</passwd>
<userid>%s</userid>
<ticket>%s</ticket>
<client-id>%s</client-id>
<host-name>%s</host-name>
<user-agent>%s</user-agent>
<local-time>%s</local-time>
</request>''' % (
        passwd, user_id,
        ticket, client_id, host_name,
        user_agent, local_time
    )

    return payload_encode(content)


def build_keep_payload(
        user_agent, local_time,
        ticket, host_name, client_id):
    content = '''<?xml version="1.0" encoding="UTF-8"?>
<request>
<user-agent>%s</user-agent>
<local-time>%s</local-time>
<ticket>%s</ticket>
<host-name>%s</host-name>
<client-id>%s</client-id>
</request>''' % (
        user_agent, local_time,
        ticket, host_name, client_id
    )

    return payload_encode(content)


def build_term_payload(
        user_agent, ticket, local_time,
        host_name, client_id, reason=1):
    content = '''<?xml version="1.0" encoding="UTF-8"?>
<request>
<user-agent>%s</user-agent>
<ticket>%s</ticket>
<local-time>%s</local-time>
<host-name>%s</host-name>
<reason>%s</reason>
<client-id>%s</client-id>
</request>''' % (
        user_agent, ticket, local_time,
        host_name, reason, client_id
    )

    return payload_encode(content)
